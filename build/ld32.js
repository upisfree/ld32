(function(){function a(a,b){for(var c=a.length,e=Math.floor(c/2),f=-1,g=0,h=0,i=!1,j=new Array(e),k=0;c>k;k++){var l=a[k];h+=l*l}if(h=Math.sqrt(h/c),.01>h)return-1;for(var m=1,n=d;e>n;n++){for(var o=0,k=0;e>k;k++)o+=Math.abs(a[k]-a[k+n]);if(o=1-o/e,j[n]=o,o>.9&&o>m)i=!0,o>g&&(g=o,f=n);else if(i){var p=(j[f+1]-j[f-1])/j[f];return b/(f+8*p)}m=o}return g>.01?b/f:-1}var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E;for(Math.randomInt=function(a,b){return Math.floor(Math.random()*(b-a+1)+a)},Math.rToD=function(a){return a*(180/Math.PI)},Math.dToR=function(a){return a*(Math.PI/180)},D=function(a){return a-=Math.PI/2,{x:Math.cos(a),y:Math.sin(a)}},Array.prototype.min=function(){return Math.min.apply(null,this)},Array.prototype.max=function(){return Math.max.apply(null,this)},Array.prototype.remove=function(a,b){var c,d;return c=this.slice((b||a)+1||this.length),this.length=null!=(d=0>a)?d:this.length+{from:a},this.push.apply(this,c)},p=function(a){return document.getElementById(a)},o=function(a){return document.getElementsByClassName(a)},q=function(a){return document.getElementsByTagName(a)},x=[],n=function(){var a;for(a=0;a<x.length-1;)x[a].destroy(),a+=1;return x=[]},e=function(){function a(a,c){this.body=Matter.Bodies.rectangle(a,c,125,75,{mass:1e3,frictionAir:.1,render:{sprite:{texture:"assets/zombie.png"}}}),this.body.i=x.length,this.body.label+=",npc",Matter.Composite.add(b.world,this.body),x.push(this)}return a.prototype.destroy=function(){var a;return o("zombie-death")[Math.randomInt(0,2)].play(),a=PIXI.Sprite.fromImage("assets/blood.png"),a.width=75,a.height=75,a.anchor.x=.5,a.anchor.y=.5,a.position.x=this.body.position.x,a.position.y=this.body.position.y,a.rotation=Math.randomInt(0,2*Math.PI),j.addChild(a),Matter.Composite.remove(b.world,this.body),g+=1,p("zombies").innerText="ZOMBIES: "+g},a}(),window.ontouchmove=function(a){return a.preventDefault()},window.w=window.innerWidth,window.h=window.innerHeight,v=0,w=0,c=500,g=0,f=Date.now(),j=new PIXI.DisplayObjectContainer,A=PIXI.Sprite.fromImage("assets/scene.png"),A.width=window.w,A.height=1680,A.position.x=0,A.position.y=window.h/2-A.height,Matter.RenderPixi.create=function(a){var b,c;return b={controller:Matter.RenderPixi,element:null,canvas:null,options:{width:window.innerWidth,height:window.innerHeight,background:"#ffffff",wireframeBackground:"#222",enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1}},c=Matter.Common.extend(b,a),c.context=new PIXI.WebGLRenderer(window.innerWidth,window.innerHeight,c.canvas,!0,!0),c.canvas=c.context.view,c.stage=new PIXI.Stage,c.textures={},c.sprites={},c.primitives={},c.spriteBatch=new PIXI.DisplayObjectContainer,c.stage.addChild(c.spriteBatch),Matter.Common.isElement(c.element)?c.element.appendChild(c.canvas):Matter.Common.log('No "render.element" passed, "render.canvas" was not inserted into document.',"warn"),c.canvas.oncontextmenu=function(){return!1},c.canvas.onselectstart=function(){return!1},c},Matter.RenderPixi.world=function(a){var b,c,d,e,f,g,h,i,k,l,m,n,o;for(h=a.render,k=a.world,f=a.map,d=h.context,i=h.stage,g=h.options,b=Matter.Composite.allBodies(k),c=Matter.Composite.allConstraints(k),h.spriteBatch.addChildAt(j,0),h.spriteBatch.addChildAt(A,0),l=0,n=b.length;n>l;l++)e=b[l],Matter.RenderPixi.body(a,e);for(m=0,o=c.length;o>m;m++)e=c[m],Matter.RenderPixi.constraint(a,e);return d.render(i)},Matter.RenderPixi.body=function(a,b){var c,d,e,f,g;return d=a.render,c=b.render,f=d.spriteBatch,c.visible&&c.sprite&&c.sprite.texture?(g="b-"+b.id,e=d.sprites[g],e||(e=d.sprites[g]=Matter.RenderPixi._createBodySprite(d,b)),-1===f.children.indexOf(e)&&f.addChild(e),e.position.x=b.position.x,e.position.y=b.position.y,e.width=b.label.split(",")[0],e.height=b.label.split(",")[1],e.rotation=b.angle):void 0},Matter.RenderPixi._getTexture=function(a,b){var c;return c=a.textures[b],c||(c=a.textures[b]=PIXI.Texture.fromImage(b)),c},Matter.RenderPixi._createBodySprite=function(a,b){var c,d,e,f;return c=b.render,f=c.sprite.texture,e=Matter.RenderPixi._getTexture(a,f),d=new PIXI.Sprite(e),d.anchor.x=.5,d.anchor.y=.5,d},b=Matter.Engine.create(document.body,{world:{gravity:{x:0,y:0},bounds:{min:{x:-(1/0),y:-(1/0)},max:{x:1/0,y:1/0}}},enableSleeping:!0,render:{controller:Matter.RenderPixi,options:{currentBackground:"none",width:window.w,height:window.h,wireframes:!1}}}),setTimeout(function(){return p("start-screen").style.display="none",Matter.Engine.run(b),f=Date.now()},4e3),B=function(a){return b.render.context.offset=new PIXI.Point(a.x,a.y)},y=Matter.Bodies.rectangle(window.w/2,window.h/2-300,125,75,{mass:1e3,frictionAir:.1,render:{sprite:{texture:"assets/player.png"}}}),Matter.Composite.add(b.world,y),y.label+=",player",window.onmousemove=function(a){return v=a.x,w=a.y},window.onkeydown=function(a){switch(a.keyCode){case 87:case 38:return Matter.Body.applyForce(y,{x:0,y:0},Matter.Vector.mult(D(y.angle),10));case 83:case 40:return Matter.Body.applyForce(y,{x:0,y:0},Matter.Vector.neg(Matter.Vector.mult(D(y.angle),10)))}},t=E=0;5>E;t=++E)new e(y.position.x+Math.randomInt(-window.w/2,window.w/2),y.position.y+Math.randomInt(-window.h/2,window.h/2));Matter.Events.on(b,"collisionActive",function(a){var d,e,f,g,h;for(g=a.pairs,h=[],e=0,f=g.length;f>e;e++)d=g[e],"player"===d.bodyA.label.split(",")[2]&&"npc"===d.bodyB.label.split(",")[2]||"player"===d.bodyB.label.split(",")[2]&&"npc"===d.bodyA.label.split(",")[2]?0===c?(p("end-screen").style.display="block",q("canvas")[0].className="blur",h.push(setTimeout(function(){return location.reload()},5e3))):(Matter.RenderPixi.setBackground(b.render,z(Math.randomInt(0,255),0,0)),c-=1,p("lifes").innerText="LIFES: "+c,h.push(o("player-hit")[Math.randomInt(0,2)].play())):h.push(void 0);return h}),d=0,h=null,l=1024,k=new Float32Array(l),i=null,u=null,h=null,s=function(a){return window.AudioContext=window.AudioContext||window.webkitAudioContext,i=new AudioContext,u=i.createMediaStreamSource(a),h=i.createAnalyser(),h.fftSize=2048,u.connect(h),f=Date.now()},C=function(){var b,c;return c=new Array,h.getFloatTimeDomainData(k),b=a(k,i.sampleRate),b>50&&300>b?x[x.length-1].destroy():void 0},navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia,navigator.getUserMedia({audio:{mandatory:{googEchoCancellation:"true",googAutoGainControl:"true",googNoiseSuppression:"true",googHighpassFilter:"true"}},optional:[]},s,function(){return alert("Microphone fails! Can't play :(")}),r=function(){return{r:Math.randomInt(0,255),g:Math.randomInt(0,255),b:Math.randomInt(0,255)}},z=function(a,b,c){return"#"+((1<<24)+(a<<16)+(b<<8)+c).toString(16).slice(1)},m=r(),Matter.RenderPixi.setBackground(b.render,z(m.r,m.g,m.b)),Matter.Events.on(b,"tick",function(a){var b,c,d,g,h;if(C(),B({x:window.w/2-y.position.x,y:window.h/2-y.position.y}),y.angle=Math.atan2(window.h/2-w,window.w/2-v)-Math.PI/2,p("time").innerText="TIME: "+((Date.now()-f)/1e3).toFixed(1)+"s",Math.random()<.05)for(t=c=0;3>c;t=++c)new e(y.position.x+Math.randomInt(-window.w/2,window.w/2),y.position.y+Math.randomInt(-window.h/2,window.h/2));if(Math.random()<.05){for(h=[],d=0,g=x.length;g>d;d++)b=x[d],h.push(Matter.Body.applyForce(b.body,{x:0,y:0},Matter.Vector.mult(Matter.Vector.sub({x:b.body.position.x,y:b.body.position.y},{x:y.position.x,y:y.position.y}),-.1)));return h}})}).call(this);